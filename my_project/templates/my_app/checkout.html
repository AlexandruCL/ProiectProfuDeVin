{% extends 'my_app/base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Checkout{% endblock %}

{% block body_class %}{% endblock %}

{% block page_css %}
    <link href="{% static 'css/checkout.css' %}?v=20260107" rel="stylesheet">
    <style>
        .custom-input:focus {
            box-shadow: 0 0 15px #6b1842;
            outline-color: #6b1842;
            outline-offset: 0.25rem;
            outline-style: inherit;
        }
        .placeholder-red::placeholder {
            color: red;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="site-container site-container-fluid">
        <div class="checkout-card">
            <div class="checkout-head">
                <h1 class="checkout-title">Checkout</h1>
                <div class="checkout-total">Total: {{ total_value|floatformat:2 }} RON</div>
            </div>

            <div class="checkout-grid">
                <section class="checkout-summary" aria-label="Order summary">
                    <h2 class="checkout-subtitle">Order Summary</h2>

                    <ul class="checkout-items">
                        {% for item in cart_items %}
                            <li class="checkout-item">
                                <div class="checkout-item-media">
                                    {% if item.wine and item.wine.image %}
                                        <img src="{{ item.wine.image.url }}" alt="{{ item.wine.Name }}" class="checkout-item-img">
                                    {% elif item.spirit and item.spirit.image %}
                                        <img src="{{ item.spirit.image.url }}" alt="{{ item.spirit.Name }}" class="checkout-item-img">
                                    {% endif %}
                                </div>

                                <div class="checkout-item-body">
                                    <div class="checkout-item-name">
                                        {% if item.wine %}
                                            {{ item.wine.Name }}
                                        {% else %}
                                            {{ item.spirit.Name }}
                                        {% endif %}
                                    </div>
                                    <div class="checkout-item-meta">Quantity: {{ item.quantity }}</div>
                                    {% if item.quantity > 1 %}
                                        <div class="checkout-item-meta">Price: {{ item.price|floatformat:2 }} RON each</div>
                                    {% else %}
                                        <div class="checkout-item-meta">Price: {{ item.price|floatformat:2 }} RON</div>
                                    {% endif %}
                                    <div class="checkout-item-total">Total: {{ item.price|floatformat:2|multiply:item.quantity }} RON</div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </section>

                <aside class="sticky-container checkout-form" aria-label="Shipping information">
                    <h2 class="checkout-subtitle">Shipping Information</h2>
                    <form method="post" class="checkout-form-fields">
                        {% csrf_token %}

                        <div class="checkout-field">
                            <label for="id_first_name" class="checkout-label">First Name</label>
                            <input type="text" name="first_name" id="id_first_name" class="custom-input {% if form.first_name.errors %} placeholder-red {% endif %}" value="{% if form.first_name.errors %}{{ ''}}{% else %}{{ form.first_name.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.first_name.errors %}{{ form.first_name.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_last_name" class="checkout-label">Last Name</label>
                            <input type="text" name="last_name" id="id_last_name" class="custom-input {% if form.last_name.errors %} placeholder-red {% endif %}" value="{% if form.last_name.errors %}{{ '' }}{% else %}{{ form.last_name.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.last_name.errors %}{{ form.last_name.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_email" class="checkout-label">Email</label>
                            <input type="email" name="email" id="id_email" class="custom-input {% if form.email.errors %} placeholder-red {% endif %}" value="{% if form.email.errors %}{{ '' }}{% else %}{{ form.email.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.email.errors %}{{ form.email.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_phone_number" class="checkout-label">Phone Number</label>
                            <input type="text" name="phone_number" id="id_phone_number" maxlength="10" class="custom-input {% if form.phone_number.errors %} placeholder-red {% endif %}" value="{% if form.phone_number.errors %}{{ '' }}{% else %}{{ form.phone_number.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.phone_number.errors %}{{ form.phone_number.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_address" class="checkout-label">Address</label>
                            <input type="text" name="address" id="id_address" class="custom-input {% if form.address.errors %} placeholder-red {% endif %}" value="{% if form.address.errors %}{{ '' }}{% else %}{{ form.address.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.address.errors %}{{ form.address.errors.0 }}{% else %} Add all information about the address, including Nr. , Bl. Nr. , Floor Nr. , Ap. Nr. {% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_city" class="checkout-label">City</label>
                            <input type="text" name="city" id="id_city" class="custom-input {% if form.city.errors %} placeholder-red {% endif %}" value="{% if form.city.errors %}{{ '' }}{% else %}{{ form.city.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.city.errors %}{{ form.city.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_county" class="checkout-label">County</label>
                            <input type="text" name="county" id="id_county" class="custom-input {% if form.county.errors %} placeholder-red {% endif %}" value="{% if form.county.errors %}{{ '' }}{% else %}{{ form.county.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.county.errors %}{{ form.county.errors.0 }}{% endif %}">
                        </div>

                        <div class="checkout-field">
                            <label for="id_postal_code" class="checkout-label">Postal Code</label>
                            <input type="text" name="postal_code" id="id_postal_code" maxlength="6" class="custom-input {% if form.postal_code.errors %} placeholder-red {% endif %}" value="{% if form.postal_code.errors %}{{ '' }}{% else %}{{ form.postal_code.value|default_if_none:'' }}{% endif %}" placeholder="{% if form.postal_code.errors %}{{ form.postal_code.errors.0 }}{% endif %}">
                        </div>

                        <button class="button" type="submit">
                            <div class="wrap">
                                <p>
                                    <span>✧</span>
                                    <span>✦</span>
                                    <span>Place Order</span>
                                    <span>Thank you for your order!</span>
                                    <span>✧</span>
                                    <span>✦</span>
                                </p>
                            </div>
                        </button>
                    </form>
                </aside>
            </div>
        </div>
    </div>
{% endblock %}