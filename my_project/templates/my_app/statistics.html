{% extends 'my_app/base.html' %}

{% block title %}Statistics{% endblock %}

{% block head_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block page_css %}
<style>
    .chart-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin: 0 auto;
        max-width: 1100px;
    }

    .chart-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        padding: 1rem;
        overflow: hidden;
    }

    .chart-card canvas {
        width: 100% !important;
        height: 320px !important;
    }

    @media (min-width: 1024px) {
        .chart-card canvas { height: 420px !important; }
    }
</style>
{% endblock %}

{% block content %}
    <div class="site-container">
        <div class="chart-container">
            <div class="chart-card">
                <canvas id="winesChart"></canvas>
            </div>
            <div class="chart-card">
                <canvas id="spiritsChart"></canvas>
            </div>
        </div>
    </div>
    <script>
        const winesData = {
        labels: [{% for wine in most_sold_wines %}"{{ wine.wine__Name|escapejs }}",{% endfor %}],
        datasets: [{
            label: 'Most Sold Wines in the last 30 days',
            data: [{% for wine in most_sold_wines %}{{ wine.total_sold }},{% endfor %}],
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    };

    const spiritsData = {
        labels: [{% for spirit in most_sold_spirits %}"{{ spirit.spirit__Name|escapejs }}",{% endfor %}],
        datasets: [{
            label: 'Most Sold Spirits in the last 30 days',
            data: [{% for spirit in most_sold_spirits %}{{ spirit.total_sold }},{% endfor %}],
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
        }]
    };

        const configWines = {
            type: 'bar',
            data: winesData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        };

        const configSpirits = {
            type: 'bar',
            data: spiritsData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        };

        const winesChart = new Chart(
            document.getElementById('winesChart'),
            configWines
        );

        const spiritsChart = new Chart(
            document.getElementById('spiritsChart'),
            configSpirits
        );
    </script>
{% endblock %}